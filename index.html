<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoTani - Platform Pertanian Cerdas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        :root {
            --primary: #2E7D32;
            --primary-light: #4CAF50;
            --primary-dark: #1B5E20;
            --secondary: #FF9800;
            --warning: #F44336;
            --info: #2196F3;
            --light: #F5F5F5;
            --dark: #333333;
            --gray: #757575;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: var(--dark);
            line-height: 1.6;
        }

        /* Header & Navigation */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo h1 {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .logo i {
            color: var(--primary);
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem;
        }

        nav a {
            text-decoration: none;
            color: var(--gray);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        nav a:hover {
            color: var(--primary);
            background-color: rgba(46, 125, 50, 0.1);
        }

        nav a.active {
            color: var(--primary);
            background-color: rgba(46, 125, 50, 0.1);
            font-weight: 600;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-title {
            margin-bottom: 1.5rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.1rem;
            color: var(--gray);
            font-weight: 500;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .icon-primary {
            background-color: rgba(46, 125, 50, 0.1);
            color: var(--primary);
        }

        .icon-warning {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--warning);
        }

        .icon-info {
            background-color: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .card-footer {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Chart Container */
        .chart-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-title {
            margin-bottom: 1rem;
            color: var(--primary-dark);
        }

        .chart-placeholder {
            min-height: 300px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-style: italic;
        }

        /* Map Container */
        .map-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
        }

        #map {
            height: 500px;
            border-radius: 8px;
            z-index: 1;
        }

        .map-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Legend for Map */
        .map-legend {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 50%;
        }

        /* Warning Cards */
        .warning-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .warning-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            border-left: 4px solid var(--warning);
        }

        .warning-card.medium {
            border-left-color: var(--secondary);
        }

        .warning-card.low {
            border-left-color: var(--info);
        }

        .warning-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .warning-title {
            font-weight: 600;
            color: var(--dark);
        }

        .warning-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-high {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--warning);
        }

        .badge-medium {
            background-color: rgba(255, 152, 0, 0.1);
            color: var(--secondary);
        }

        .badge-low {
            background-color: rgba(33, 150, 243, 0.1);
            color: var(--info);
        }

        .warning-location {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .warning-desc {
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .warning-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        /* Weather Info */
        .weather-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .weather-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            text-align: center;
        }

        .weather-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--info);
        }

        .weather-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .weather-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            background-color: var(--primary-dark);
            color: white;
            padding: 2rem;
            margin-top: 3rem;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .footer-section p, .footer-section a {
            color: rgba(255,255,255,0.7);
            margin-bottom: 0.5rem;
            display: block;
            text-decoration: none;
        }

        .footer-section a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.5);
            font-size: 0.9rem;
        }

        /* Map Fullscreen Mode */
        .map-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2000;
            background: white;
        }

        .map-fullscreen .map-container {
            height: 100%;
            padding: 0;
            border-radius: 0;
            margin: 0;
        }

        .map-fullscreen #map {
            height: 100%;
            border-radius: 0;
        }

        .close-fullscreen {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 2001;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        /* --- STYLING BARU UNTUK HALAMAN DATA PETANI --- */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            color: var(--gray);
            font-weight: 500;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background-color: #f8f9fa;
        }
        
        /* Style untuk dropdown yang disabled */
        .form-group select:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .table-wrapper {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: #f8f9fa;
            color: var(--primary-dark);
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .data-table tbody tr:hover {
            background-color: #f5f5f5;
        }
        /* --- AKHIR STYLING BARU --- */

        /* MODAL UNTUK PEMILIHAN LOKASI DI PETA */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            height: 80%;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-body {
            flex: 1;
            position: relative;
        }

        #mapModal {
            height: 100%;
            border-radius: 8px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .location-preview {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .location-preview strong {
            color: var(--primary);
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-container {
                padding: 1rem;
                position: relative;
            }

            nav ul {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 1rem;
                box-shadow: 0 5px 10px rgba(0,0,0,0.1);
                z-index: 1001;
            }

            nav ul.show {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .container {
                padding: 1rem;
            }

            .cards, .warning-cards, .weather-cards {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .map-fullscreen .map-container {
                padding: 0;
            }

            .map-legend {
                bottom: 20px;
                right: 20px;
                padding: 10px;
                font-size: 0.8rem;
            }

            /* Footer untuk Mobile */
            footer {
                padding: 1.5rem 1rem;
                margin-top: 2rem;
            }

            .footer-container {
                grid-template-columns: 1fr;
                gap: 1.5rem;
                text-align: center;
            }

            .footer-section h3 {
                font-size: 1.1rem;
                margin-bottom: 0.8rem;
            }

            .footer-section p, .footer-section a {
                font-size: 0.85rem;
                margin-bottom: 0.4rem;
            }

            .copyright {
                padding-top: 1.5rem;
                margin-top: 1.5rem;
                font-size: 0.8rem;
            }

            /* Modal responsive */
            .modal-content {
                margin: 10% auto;
                width: 95%;
                height: 85%;
            }
        }
        
        /* Penyesuaian grid hasil data petani di desktop */
        @media (min-width: 992px) {
            .results-grid {
                /* Buat 2 kolom di desktop */
                grid-template-columns: repeat(2, 1fr);
            }
            .results-grid .chart-container:first-child {
                /* Tabel data memakan 2 kolom */
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 480px) {
            footer {
                padding: 1rem 0.8rem;
            }
            
            .footer-container {
                gap: 1rem;
            }
            
            .footer-section h3 {
                font-size: 1rem;
            }
            
            .footer-section p, .footer-section a {
                font-size: 0.8rem;
            }
            
            .copyright {
                font-size: 0.75rem;
            }
        }

        /* Smooth scrolling for page transitions */
        html {
            scroll-behavior: smooth;
        }

        /* Loading indicator for weather */
        .weather-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-seedling"></i>
                <h1>GeoTani</h1>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <nav>
                <ul id="navMenu">
                    <li><a href="#dashboard" class="nav-link active" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#peta" class="nav-link" data-page="peta"><i class="fas fa-map-marker-alt"></i> Peta Petani</a></li>
                    <li><a href="#datapetani" class="nav-link" data-page="datapetani"><i class="fas fa-users"></i> Data Petani</a></li>
                    <li><a href="#cuaca" class="nav-link" data-page="cuaca"><i class="fas fa-cloud-sun"></i> Data Cuaca</a></li>
                    <li><a href="#warning" class="nav-link" data-page="warning"><i class="fas fa-exclamation-triangle"></i> Early Warning</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <div id="dashboard-page" class="page active">
            <h2 class="page-title"><i class="fas fa-home"></i> Dashboard</h2>
            
            <div class="cards">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Luas Tanam Aktif</div>
                        <div class="card-icon icon-primary">
                            <i class="fas fa-tractor"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dashboardLuasAktif">0 Ha</div>
                    <div class="card-footer">Data dari petani terdaftar</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Estimasi Produksi</div>
                        <div class="card-icon icon-info">
                            <i class="fas fa-weight-hanging"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dashboardEstimasiProduksi">0 Ton</div>
                    <div class="card-footer">Berdasarkan luas & komoditas</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Jumlah Petani Terdata</div>
                        <div class="card-icon icon-primary">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="card-value" id="dashboardJumlahPetani">0</div>
                    <div class="card-footer">Total petani di sistem</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Distribusi Luas Lahan per Kecamatan</h3>
                <div class="chart-placeholder" id="dashboardLuasPerKecamatan">
                    [Grafik Distribusi Luas Lahan Akan Ditampilkan Di Sini]
                </div>
            </div>
            
             <div class="chart-container">
                <h3 class="chart-title">Distribusi Jumlah Petani per Komoditas</h3>
                <div class="chart-placeholder" id="dashboardKomoditas">
                    [Grafik Distribusi Komoditas Akan Ditampilkan Di Sini]
                </div>
            </div>
        </div>

        <div id="peta-page" class="page">
            <h2 class="page-title"><i class="fas fa-map-marker-alt"></i> Peta Sebaran Petani</h2>
            
            <div class="map-controls">
                <button class="filter-btn active" data-filter="all">Semua Komoditas</button>
                <button class="filter-btn" data-filter="Padi">Padi</button>
                <button class="filter-btn" data-filter="Jagung">Jagung</button>
                <button class="filter-btn" data-filter="Ubi">Ubi</button>
                <button class="filter-btn" data-filter="Cabai">Cabai</button>
                <button class="btn btn-outline" id="fullscreenToggle"><i class="fas fa-expand"></i> Layar Penuh</button>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
                <div class="map-legend">
                    <div class="legend-title">Keterangan Komoditas</div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4CAF50;"></div><span>Padi</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFC107;"></div><span>Jagung</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #795548;"></div><span>Ubi</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #F44336;"></div><span>Cabai</span>
                    </div>
                     <div class="legend-item">
                        <div class="legend-color" style="background-color: #9C27B0;"></div><span>Lainnya</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="datapetani-page" class="page">
            <h2 class="page-title"><i class="fas fa-users"></i> Input & Proses Data Petani</h2>
            
            <div class="card" style="margin-bottom: 2rem;">
                <div class="card-header" style="margin-bottom: 1rem;">
                    <h3 class="card-title" style="font-size: 1.3rem; color: var(--primary-dark);">Formulir Input Data Petani</h3>
                </div>
                <form id="petaniForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="namaPetani">Nama Petani</label>
                            <input type="text" id="namaPetani" required>
                        </div>
                        <div class="form-group">
                            <label for="kelompokTani">Kelompok Tani</label>
                            <input type="text" id="kelompokTani">
                        </div>
                        <div class="form-group">
                            <label for="kecamatan">Kecamatan</label>
                            <select id="kecamatan" required>
                                <option value="">Pilih Kecamatan</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="kelurahan">Kelurahan / Desa</label>
                            <select id="kelurahan" required disabled>
                                <option value="">Pilih Kecamatan Dulu</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="luasLahan">Luas Lahan (Ha)</label>
                            <input type="number" id="luasLahan" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="komoditi">Jenis Komoditi</label>
                            <select id="komoditi" required>
                                <option value="">Pilih Komoditi</option>
                                <option value="Padi">Padi</option>
                                <option value="Jagung">Jagung</option>
                                <option value="Ubi">Ubi</option>
                                <option value="Tomat">Tomat</option>
                                <option value="Cabai">Cabai</option>
                                <option value="Sayur">Sayur</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Pilih Lokasi di Peta</label>
                            <button type="button" class="btn btn-outline" id="pilihLokasiBtn">
                                <i class="fas fa-map-marker-alt"></i> Pilih Lokasi di Peta
                            </button>
                            <div id="previewLokasi" class="location-preview">
                                Belum ada lokasi dipilih
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">
                        <i class="fas fa-cogs"></i> Proses & Simpan Data
                    </button>
                    <button type="button" class="btn btn-outline" id="clearDataBtn" style="margin-top: 1rem; margin-left: 10px; border-color: var(--warning); color: var(--warning);">
                        <i class="fas fa-trash"></i> Hapus Semua Data
                    </button>
                </form>
            </div>
            
            <h3 class="chart-title">Hasil Analisis Data Petani</h3>
            
            <div class="chart-container">
                <h3 class="chart-title">Data Petani Tersimpan</h3>
                <div class="table-wrapper">
                    <table class="data-table" id="petaniTable">
                        <thead>
                            <tr>
                                <th>Nama Petani</th>
                                <th>Kecamatan</th>
                                <th>Kelurahan</th>
                                <th>Komoditi</th>
                                <th>Luas (Ha)</th>
                                <th>Est. Panen (Ton)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="6" style="text-align: center; color: var(--gray);">Belum ada data</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="cuaca-page" class="page">
            <h2 class="page-title"><i class="fas fa-cloud-sun"></i> Data Cuaca</h2>
            
            <div class="weather-cards">
                <div class="weather-card">
                    <div class="weather-icon"><i class="fas fa-cloud-rain"></i></div>
                    <div class="weather-value" id="rainfall">45 mm</div>
                    <div class="weather-label">Curah Hujan</div>
                </div>
                <div class="weather-card">
                    <div class="weather-icon"><i class="fas fa-thermometer-half"></i></div>
                    <div class="weather-value" id="temperature">28Â°C</div>
                    <div class="weather-label">Suhu Rata-rata</div>
                </div>
                <div class="weather-card">
                    <div class="weather-icon"><i class="fas fa-tint"></i></div>
                    <div class="weather-value" id="humidity">82%</div>
                    <div class="weather-label">Kelembapan</div>
                </div>
                <div class="weather-card">
                    <div class="weather-icon"><i class="fas fa-wind"></i></div>
                    <div class="weather-value" id="wind">12 km/jam</div>
                    <div class="weather-label">Kecepatan Angin</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 class="chart-title">Prakiraan Cuaca 7 Hari Ke Depan <span id="weatherLoading" class="weather-loading"></span></h3>
                <div class="chart-placeholder" id="weatherChart">[Grafik Prakiraan Cuaca Akan Ditampilkan Di Sini]</div>
            </div>
        </div>

        <div id="warning-page" class="page">
            <h2 class="page-title"><i class="fas fa-exclamation-triangle"></i> Sistem Peringatan Dini</h2>
            
            <div class="warning-cards">
                 <div class="warning-card">
                    <div class="warning-header">
                        <div class="warning-title">Potensi Kekeringan</div>
                        <div class="warning-badge badge-high">Tinggi</div>
                    </div>
                    <div class="warning-location"><i class="fas fa-map-marker-alt"></i><span>Wilayah Oba Tengah, Tidore</span></div>
                    <div class="warning-desc">Prediksi kekeringan dengan tingkat keparahan tinggi dalam 7-10 hari ke depan. Dampak potensial pada tanaman padi fase generatif.</div>
                    <div class="warning-actions">
                        <button class="btn btn-primary"><i class="fas fa-lightbulb"></i> Lihat Rekomendasi</button>
                        <button class="btn btn-outline"><i class="fas fa-info-circle"></i> Detail</button>
                    </div>
                </div>
                 <div class="warning-card medium">
                    <div class="warning-header">
                        <div class="warning-title">Serangan Hama Wereng</div>
                        <div class="warning-badge badge-medium">Sedang</div>
                    </div>
                    <div class="warning-location"><i class="fas fa-map-marker-alt"></i><span>Kecamatan Tidore, Kota Tidore</span></div>
                    <div class="warning-desc">Laporan serangan hama wereng coklat pada tanaman padi usia 45-60 HST. Tingkat kerusakan saat ini 15-20%.</div>
                    <div class="warning-actions">
                        <button class="btn btn-primary"><i class="fas fa-lightbulb"></i> Lihat Rekomendasi</button>
                        <button class="btn btn-outline"><i class="fas fa-info-circle"></i> Detail</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Pilih Lokasi di Peta -->
    <div id="modalPeta" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Pilih Lokasi Lahan</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="mapModal"></div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <h3>GeoTani</h3>
                <p>Platform pemantauan pertanian cerdas</p>
            </div>
            <div class="footer-section">
                <h3>Kontak</h3>
                <p><i class="fas fa-envelope"></i> info@geotani.id</p>
                <p><i class="fas fa-phone"></i> (021) 1234-5678</p>
            </div>
            <div class="footer-section">
                <h3>Tautan</h3>
                <a href="#dashboard">Dashboard</a>
                <a href="#peta">Peta Petani</a>
                <a href="#cuaca">Data Cuaca</a>
            </div>
        </div>
        <div class="copyright">&copy; 2023 GeoTani. All rights reserved.</div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // ===================================================================
        // 1. DATA UTAMA & KONFIGURASI
        // ===================================================================

        // Data Kecamatan dan Kelurahan di Kota Tidore Kepulauan (dengan koordinat)
        const tidoreData = {
            "Tidore": {
                "Gamtufkange": [0.7380, 127.4250], "Tomagoba": [0.6581, 127.4396], "Tuguwaji": [0.6702, 127.4435],
                "Soasio": [0.6601, 127.4468], "Gurabati": [0.6895, 127.4215],
            },
            "Tidore Selatan": {
                "Toboaru": [0.6455, 127.4285], "Gurabunga": [0.6359, 127.4093], "Tosa": [0.6180, 127.4300],
            },
            "Tidore Utara": {
                "Rum": [0.7930, 127.4245], "Ome": [0.7651, 127.4523], "Mareku": [0.7498, 127.4611],
            },
            "Oba Utara": {
                "Sofifi": [0.7580, 127.5710], "Galala": [0.8123, 127.5589],
            },
             "Oba Tengah": {
                "Akelamo": [0.7063, 127.4322], "Tewe": [0.6912, 127.3512],
            }
        };

        // Produktivitas rata-rata per komoditas (ton/ha)
        const PRODUCTIVITY_RATES = {
            'Padi': 6, 'Jagung': 7, 'Ubi': 10, 'Tomat': 8, 'Cabai': 9, 'Sayur': 7, 'Lainnya': 3
        };
        
        // Warna untuk marker di peta
        const COMMODITY_COLORS = {
            'Padi': '#4CAF50', 'Jagung': '#FFC107', 'Ubi': '#795548', 'Tomat': '#FF5722', 
            'Cabai': '#F44336', 'Sayur': '#8BC34A', 'Lainnya': '#9C27B0'
        };

        // Variabel global
        let petaniData = JSON.parse(localStorage.getItem('petaniData')) || [];
        let map;
        let mapModal;
        let mapMarkers = [];
        let selectedCoords = null; // Menyimpan koordinat sementara yang dipilih di modal

        // ===================================================================
        // 2. INISIALISASI HALAMAN & EVENT LISTENERS
        // ===================================================================

        // Inisialisasi semua komponen saat halaman dimuat
        function initializeApp() {
            // Setup Navigasi
            setupNavigation();
            
            // Setup Form Petani
            initPetaniPage();
            
            // Setup Peta Utama
            initMap();
            
            // Setup Modal Peta
            initModalMap();
            
            // Muat & tampilkan semua data dari localStorage
            updateAllViews();
            
            // Setup komponen lain
            document.getElementById('mobileMenuBtn').addEventListener('click', () => document.getElementById('navMenu').classList.toggle('show'));
            document.getElementById('fullscreenToggle').addEventListener('click', toggleMapFullscreen);
            setupMapFilters();
        }

        // Pengaturan Navigasi Halaman
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    
                    const pageId = this.getAttribute('data-page') + '-page';
                    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                    document.getElementById(pageId).classList.add('active');
                    
                    document.getElementById('navMenu').classList.remove('show');
                    
                    // Penting: Invalidate map size saat tab peta aktif
                    if (pageId === 'peta-page' && map) {
                         setTimeout(() => map.invalidateSize(), 1);
                    }
                });
            });
        }
        
        // Inisialisasi Form di Halaman Data Petani
        function initPetaniPage() {
            const form = document.getElementById('petaniForm');
            const clearBtn = document.getElementById('clearDataBtn');
            const kecamatanSelect = document.getElementById('kecamatan');
            const kelurahanSelect = document.getElementById('kelurahan');
            const pilihLokasiBtn = document.getElementById('pilihLokasiBtn');

            if (!form) return;

            form.addEventListener('submit', handlePetaniFormSubmit);
            clearBtn.addEventListener('click', clearAllPetaniData);
            pilihLokasiBtn.addEventListener('click', openModal);
            
            // Isi dropdown kecamatan
            Object.keys(tidoreData).forEach(kecamatan => {
                const option = document.createElement('option');
                option.value = kecamatan;
                option.textContent = kecamatan;
                kecamatanSelect.appendChild(option);
            });
            
            // Event listener untuk mengubah kelurahan saat kecamatan dipilih
            kecamatanSelect.addEventListener('change', () => {
                kelurahanSelect.innerHTML = '<option value="">Pilih Kelurahan</option>';
                const selectedKecamatan = kecamatanSelect.value;
                if (selectedKecamatan && tidoreData[selectedKecamatan]) {
                    Object.keys(tidoreData[selectedKecamatan]).forEach(kelurahan => {
                        const option = document.createElement('option');
                        option.value = kelurahan;
                        option.textContent = kelurahan;
                        kelurahanSelect.appendChild(option);
                    });
                    kelurahanSelect.disabled = false;
                } else {
                    kelurahanSelect.disabled = true;
                }
            });
        }

        // ===================================================================
        // 3. FUNGSI PENGELOLAAN DATA (CRUD)
        // ===================================================================

        // Menangani submit form data petani
        function handlePetaniFormSubmit(e) {
            e.preventDefault();
            const newData = {
                id: Date.now(),
                nama: document.getElementById('namaPetani').value,
                kelompok: document.getElementById('kelompokTani').value,
                kecamatan: document.getElementById('kecamatan').value,
                kelurahan: document.getElementById('kelurahan').value,
                luas: parseFloat(document.getElementById('luasLahan').value),
                komoditi: document.getElementById('komoditi').value,
                lokasi: selectedCoords // Simpan koordinat yang dipilih
            };
            
            petaniData.push(newData);
            localStorage.setItem('petaniData', JSON.stringify(petaniData));
            
            document.getElementById('petaniForm').reset();
            document.getElementById('kelurahan').disabled = true; // Matikan lagi dropdown kelurahan
            document.getElementById('previewLokasi').innerHTML = 'Belum ada lokasi dipilih';
            selectedCoords = null; // Reset koordinat
            
            updateAllViews(); // Panggil fungsi utama untuk sinkronisasi
        }

        // Menghapus semua data petani
        function clearAllPetaniData() {
            if (confirm('Anda yakin ingin menghapus semua data petani?')) {
                petaniData = [];
                localStorage.removeItem('petaniData');
                updateAllViews(); // Sinkronisasi setelah hapus
            }
        }

        // ===================================================================
        // 4. FUNGSI SINKRONISASI & PEMBARUAN TAMPILAN (VIEW)
        // ===================================================================

        // Fungsi utama untuk memperbarui SEMUA bagian yang tergantung pada data
        function updateAllViews() {
            updateDashboard();
            updatePetaniTable();
            updateMap();
        }

        // Memperbarui kartu & grafik di Dashboard
        function updateDashboard() {
            if (petaniData.length === 0) {
                document.getElementById('dashboardLuasAktif').textContent = '0 Ha';
                document.getElementById('dashboardEstimasiProduksi').textContent = '0 Ton';
                document.getElementById('dashboardJumlahPetani').textContent = '0';
                document.getElementById('dashboardLuasPerKecamatan').innerHTML = '[Tidak ada data untuk ditampilkan]';
                document.getElementById('dashboardKomoditas').innerHTML = '[Tidak ada data untuk ditampilkan]';
                return;
            }

            let totalLuas = 0, totalProduksi = 0;
            let luasPerKecamatan = {};
            let jumlahPerKomoditi = {};

            petaniData.forEach(data => {
                const estPanen = data.luas * (PRODUCTIVITY_RATES[data.komoditi] || 0);
                totalLuas += data.luas;
                totalProduksi += estPanen;
                luasPerKecamatan[data.kecamatan] = (luasPerKecamatan[data.kecamatan] || 0) + data.luas;
                jumlahPerKomoditi[data.komoditi] = (jumlahPerKomoditi[data.komoditi] || 0) + 1;
            });

            // Update Cards
            document.getElementById('dashboardLuasAktif').textContent = `${totalLuas.toFixed(2)} Ha`;
            document.getElementById('dashboardEstimasiProduksi').textContent = `${totalProduksi.toFixed(2)} Ton`;
            document.getElementById('dashboardJumlahPetani').textContent = petaniData.length;
            
            // Update Grafik Placeholder
            let kecamatanHTML = '<ul>';
            for(const [kec, luas] of Object.entries(luasPerKecamatan)) {
                kecamatanHTML += `<li>${kec}: <strong>${luas.toFixed(2)} Ha</strong></li>`;
            }
            document.getElementById('dashboardLuasPerKecamatan').innerHTML = kecamatanHTML + '</ul>';

            let komoditasHTML = '<ul>';
             for(const [kom, jumlah] of Object.entries(jumlahPerKomoditi)) {
                komoditasHTML += `<li>${kom}: <strong>${jumlah} Petani</strong></li>`;
            }
            document.getElementById('dashboardKomoditas').innerHTML = komoditasHTML + '</ul>';
        }

        // Memperbarui tabel di halaman Data Petani
        function updatePetaniTable() {
            const tableBody = document.getElementById('petaniTable')?.querySelector('tbody');
            if (!tableBody) return;
            
            if (petaniData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Belum ada data</td></tr>';
                return;
            }
            
            let tableHtml = '';
            petaniData.forEach(data => {
                const estPanen = data.luas * (PRODUCTIVITY_RATES[data.komoditi] || 0);
                tableHtml += `
                    <tr>
                        <td>${data.nama}</td>
                        <td>${data.kecamatan}</td>
                        <td>${data.kelurahan}</td>
                        <td>${data.komoditi}</td>
                        <td>${data.luas.toFixed(2)} Ha</td>
                        <td>${estPanen.toFixed(2)} Ton</td>
                    </tr>
                `;
            });
            tableBody.innerHTML = tableHtml;
        }

        // ===================================================================
        // 5. LOGIKA & FUNGSI PETA
        // ===================================================================
        
        // Inisialisasi peta Leaflet utama
        function initMap() {
            if (map) return; // Jika peta sudah ada, jangan buat lagi
            map = L.map('map').setView([0.68, 127.45], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        }

        // Inisialisasi peta di modal
        function initModalMap() {
            if (mapModal) return;
            mapModal = L.map('mapModal').setView([0.68, 127.45], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(mapModal);

            // Tambahkan event click untuk memilih lokasi
            let selectedMarker = null;
            mapModal.on('click', function(e) {
                // Hapus marker sebelumnya jika ada
                if (selectedMarker) {
                    mapModal.removeLayer(selectedMarker);
                }
                
                // Buat marker baru di lokasi yang diklik
                selectedMarker = L.marker(e.latlng).addTo(mapModal)
                    .bindPopup('Lokasi dipilih: ' + e.latlng.lat.toFixed(4) + ', ' + e.latlng.lng.toFixed(4))
                    .openPopup();
                
                // Simpan koordinat
                selectedCoords = [e.latlng.lat, e.latlng.lng];
                
                // Update preview
                document.getElementById('previewLokasi').innerHTML = 
                    `<strong>Koordinat:</strong> ${selectedCoords[0].toFixed(4)}, ${selectedCoords[1].toFixed(4)}`;
            });
        }

        // Membuat bentuk heksagon untuk peta
        function createHexagon(center, radius) {
            const points = [];
            for (let i = 0; i < 6; i++) {
                const angle = (i * 60) * (Math.PI / 180);
                const dx = radius * Math.cos(angle);
                const dy = radius * Math.sin(angle);
                points.push([center[0] + dy, center[1] + dx]);
            }
            return points;
        }

        // Memperbarui heksagon di peta berdasarkan data petani
        function updateMap(filter = 'all') {
            if (!map) return;
            
            // Hapus semua heksagon lama
            mapMarkers.forEach(marker => map.removeLayer(marker));
            mapMarkers = [];
            
            // Filter data jika perlu
            const filteredData = (filter === 'all') ? petaniData : petaniData.filter(d => d.komoditi === filter);

            // Buat heksagon baru
            filteredData.forEach(data => {
                let coords = data.lokasi;
                
                // Jika tidak ada koordinat spesifik, gunakan koordinat default untuk kelurahan
                if (!coords) {
                    coords = tidoreData[data.kecamatan]?.[data.kelurahan];
                }
                
                if (coords) {
                    const radius = Math.sqrt(data.luas) * 0.005;
                    const hexagonPoints = createHexagon(coords, radius);
                    const hexagon = L.polygon(hexagonPoints, {
                        color: COMMODITY_COLORS[data.komoditi] || '#9E9E9E',
                        fillColor: COMMODITY_COLORS[data.komoditi] || '#9E9E9E',
                        fillOpacity: 0.6,
                        weight: 2
                    }).addTo(map);
                    
                    hexagon.bindPopup(`
                        <h4 style="margin: 0 0 10px 0; color: #2E7D32;">${data.nama}</h4>
                        <p><strong>Komoditas:</strong> ${data.komoditi}</p>
                        <p><strong>Luas:</strong> ${data.luas} Ha</p>
                        <p><strong>Lokasi:</strong> ${data.kelurahan}, ${data.kecamatan}</p>
                    `);
                    
                    mapMarkers.push(hexagon);
                }
            });
        }
        
        // Pengaturan tombol filter di peta
        function setupMapFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.getAttribute('data-filter');
                    updateMap(filter);
                });
            });
        }
        
        // Fungsi untuk toggle fullscreen peta
        function toggleMapFullscreen() {
            const mapPage = document.getElementById('peta-page');
            mapPage.classList.toggle('map-fullscreen');
            document.body.style.overflow = mapPage.classList.contains('map-fullscreen') ? 'hidden' : '';

            // Buat atau hapus tombol close
            let closeBtn = mapPage.querySelector('.close-fullscreen');
            if (mapPage.classList.contains('map-fullscreen') && !closeBtn) {
                closeBtn = document.createElement('button');
                closeBtn.className = 'close-fullscreen';
                closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                closeBtn.onclick = toggleMapFullscreen;
                mapPage.appendChild(closeBtn);
            } else if (closeBtn) {
                closeBtn.remove();
            }
            
            this.innerHTML = mapPage.classList.contains('map-fullscreen') ? '<i class="fas fa-compress"></i> Keluar' : '<i class="fas fa-expand"></i> Layar Penuh';
            
            if (map) {
                setTimeout(() => map.invalidateSize(), 300);
            }
        }

        // ===================================================================
        // 6. FUNGSI MODAL PETA
        // ===================================================================
        
        // Membuka modal peta
        function openModal() {
            document.getElementById('modalPeta').style.display = 'block';
            
            // Inisialisasi peta modal jika belum ada
            if (!mapModal) {
                initModalMap();
            } else {
                // Jika sudah ada, invalidate size agar peta tampil benar
                setTimeout(() => mapModal.invalidateSize(), 1);
            }
        }

        // Menutup modal peta
        function closeModal() {
            document.getElementById('modalPeta').style.display = 'none';
        }

        // Setup event listeners untuk modal
        document.querySelector('.close-modal').addEventListener('click', closeModal);
        document.getElementById('modalPeta').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        // Panggil fungsi inisialisasi utama
        initializeApp();
    });
    </script>
</body>
</html>